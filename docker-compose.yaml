---
services:
  ldap:
    build: ./docker/openldap/build
    image: docker-registry.wikimedia.org/dev/bullseye-openldap:1.0.0
    healthcheck:
      test: ["CMD", "ldapsearch", "-x", "-H", "ldap://localhost:389", "-D", "cn=admin,dc=example,dc=org", "-w", "adminpassword", "-b", "dc=example,dc=org", "|", "grep", "-q", "cn=www"]
    ports:
      - "1389:389"
    volumes:
      - type: bind
        source: $PWD/docker/openldap/test_data
        target: /ldifs
    networks:
      default:
        aliases:
          - openldap.local.wmftest.net
  redis:
    image: redis:bullseye
    ports:
      - "6379:6379"
    networks:
      default:
        aliases:
          - redis.local.wmftest.net

