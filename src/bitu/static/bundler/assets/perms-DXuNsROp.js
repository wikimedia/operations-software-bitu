import{_ as w,d as D,r as d,c as C,o as i,e as l,f as b,b as f,a as c,w as o,g as n,t as r,F as R,I as P,T as S,p as T,i as I,h as M,D as V,j as $,k as j,l as h,s as N,n as B}from"./_plugin-vue_export-helper-DsS0xRz5.js";const F=D({name:"Permissions",components:{CdxTable:j,CdxButton:$,CdxDialog:V,CdxField:M,CdxIcon:I,CdxMessage:T,CdxTextArea:S,CdxInfoChip:P},methods:{async getData(){const e=await(await fetch("/accounts/api/user")).json();this.userId=e.id,this.permissions=e.permissions},onDefaultAction(){this.requestReason="",this.open=!1,this.view_logs=!1,this.view_title=""},async onPrimaryAction(){const s=document.querySelector("[name=csrfmiddlewaretoken]").value,e={user:this.userId,system:this.permission.source,key:this.permission.key,comment:this.requestReason},p="/permissions/api/requests/",g={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},body:JSON.stringify(e)},u=await fetch(p,g);if(!u.ok){if(u.status==403){const m=await u.text();this.errorMessage=m}else{const m=await u.json();this.errorMessage=m.comment[0]}this.open=!1;return}this.requestReason="",this.open=!1,this.view_logs=!1,this.permission=null,this.errorMessage=null,this.getData()},async viewLog(s){const p=await(await fetch("/permissions/api/requests/"+s.request)).json();this.logs=p.logs,this.view_title="Approval / Rejection log for "+s.name+" access request.",this.view_logs=!0},formatDate(s){const e=new Date(s);return e.toDateString()+" "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hourCycle:"h24"})}},mounted(){this.getData()},data(){return{permissions:[],permission:null,open:!1,view_logs:!1,logs:[],userId:null,errorMessage:null,view_title:"",request_deny_states:["AP","SY","PN"]}},setup(){const s=h(""),e=h("Request access to permission"),p={label:"Close"},g={label:"Submit",actionType:"progressive"},u=[{id:"name",label:"Permission"},{id:"description",label:"Description"},{id:"status",label:"Status"},{id:"actions",label:"",minWidth:"300px"}],m=[{id:"approved",label:"Status"},{id:"created",label:"Created",minWidth:"200px"},{id:"username",label:"Manager",minWidth:"100px"},{id:"comment",label:"Comment",minWidth:"320px"}];function y(a){this.permission=a,this.request_title="Request access to "+a.name,this.open=!0}return{columns:u,log_columns:m,defaultAction:p,primaryAction:g,requestPerm:y,request_title:e,requestReason:s,cdxIconJournal:N}}}),L={key:3},O={class:"cdx-table__table__cell--align-number"},W={class:"permission_dialog"};function J(s,e,p,g,u,m){const y=d("cdx-message"),a=d("cdx-info-chip"),v=d("cdx-button"),_=d("cdx-table"),k=d("cdx-text-area"),x=d("cdx-field"),q=d("cdx-dialog");return i(),C(R,null,[s.errorMessage?(i(),l(y,{key:0,type:"error","fade-in":!0},{default:o(()=>[f("p",null,[e[5]||(e[5]=f("strong",null,"Error!",-1)),n(" "+r(s.errorMessage),1)])]),_:1})):b("",!0),e[14]||(e[14]=f("br",null,null,-1)),c(_,{class:"cdx-docs-table-custom-cells",caption:"Permissions",columns:s.columns,data:s.permissions},{"item-source_display":o(({item:t})=>[n(r(t),1)]),"item-name":o(({item:t})=>[n(r(t),1)]),"item-status":o(({row:t})=>[t.state=="AP"?(i(),l(a,{key:0,status:"success"},{default:o(()=>[n(r(t.status_display),1)]),_:2},1024)):t.state=="SY"?(i(),l(a,{key:1,status:"success"},{default:o(()=>e[6]||(e[6]=[n(" Approved ")])),_:1})):t.state=="RJ"?(i(),l(a,{key:2,status:"error"},{default:o(()=>[n(r(t.status_display),1)]),_:2},1024)):(i(),C("span",L,r(t.status_display),1))]),"item-actions":o(({row:t})=>[f("div",O,[!t.existing&&s.request_deny_states.indexOf(t.state)==-1?(i(),l(v,{key:0,action:"progressive",weight:"primary",onClick:A=>s.requestPerm(t)},{default:o(()=>e[7]||(e[7]=[n(" Request ")])),_:2},1032,["onClick"])):b("",!0),e[9]||(e[9]=n(" Â  ")),t.request?(i(),l(v,{key:1,weight:"quiet","aria-label":"Log",onClick:A=>s.viewLog(t)},{default:o(()=>e[8]||(e[8]=[n(" View log ")])),_:2},1032,["onClick"])):b("",!0)])]),_:1},8,["columns","data"]),c(q,{open:s.open,"onUpdate:open":e[1]||(e[1]=t=>s.open=t),class:"cdx-demo-dialog-form-inputs",title:s.request_title,"use-close-button":!0,"default-action":s.defaultAction,"primary-action":s.primaryAction,onDefault:e[2]||(e[2]=t=>s.open=!1),onPrimary:s.onPrimaryAction},{default:o(()=>[f("p",W,r(s.permission.description),1),c(x,null,{label:o(()=>e[10]||(e[10]=[n(" Reason for request ")])),default:o(()=>[c(k,{modelValue:s.requestReason,"onUpdate:modelValue":e[0]||(e[0]=t=>s.requestReason=t),class:"cdx-demo-dialog-form-inputs__text-input"},null,8,["modelValue"])]),_:1})]),_:1},8,["open","title","default-action","primary-action","onPrimary"]),c(q,{open:s.view_logs,"onUpdate:open":e[3]||(e[3]=t=>s.view_logs=t),title:s.view_title,"use-close-button":!0,primaryActionDisabled:!0,"default-action":s.defaultAction,onDefault:e[4]||(e[4]=t=>s.view_logs=!1),class:"dialog_logs"},{default:o(()=>[c(_,{columns:s.log_columns,data:s.logs,caption:"",hideCaption:!0,"use-row-headers":!1},{"empty-state":o(()=>e[11]||(e[11]=[n(" There is no data available.")])),"item-approved":o(({item:t})=>[t?(i(),l(a,{key:0,status:"success"},{default:o(()=>e[12]||(e[12]=[n(" Approved ")])),_:1})):(i(),l(a,{key:1,status:"error"},{default:o(()=>e[13]||(e[13]=[n(" Rejected ")])),_:1}))]),"item-created":o(({item:t})=>[n(r(s.formatDate(t)),1)]),_:1},8,["columns","data"])]),_:1},8,["open","title","default-action"])],64)}const U=w(F,[["render",J]]);B(U).mount("#app");
