import{_ as P,d as D,r,c as v,o as n,f,e as a,b as g,a as m,w as o,g as i,t as l,F as R,P as S,I as T,T as I,p as L,i as j,h as M,D as V,j as $,k as N,l as q,s as B,n as F}from"./_plugin-vue_export-helper-CckzA7WH.js";const O=D({name:"Permissions",components:{CdxTable:N,CdxButton:$,CdxDialog:V,CdxField:M,CdxIcon:j,CdxMessage:L,CdxTextArea:I,CdxInfoChip:T,CdxProgressIndicator:S},methods:{async getData(){const e=await(await fetch("/accounts/api/user")).json();this.userId=e.id,this.permissions=e.permissions,this.isLoading=!1},onDefaultAction(){this.requestReason="",this.open=!1,this.view_logs=!1,this.view_title=""},async onPrimaryAction(){const s=document.querySelector("[name=csrfmiddlewaretoken]").value,e={user:this.userId,system:this.permission.source,key:this.permission.key,comment:this.requestReason},u="/permissions/api/requests/",y={method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s},body:JSON.stringify(e)},d=await fetch(u,y);if(!d.ok){if(d.status==403){const p=await d.text();this.errorMessage=p}else{const p=await d.json();this.errorMessage=p.comment[0]}this.open=!1;return}this.requestReason="",this.open=!1,this.view_logs=!1,this.permission=null,this.errorMessage=null,this.getData()},async viewLog(s){const u=await(await fetch("/permissions/api/requests/"+s.request)).json();this.logs=u.logs,this.view_title="Approval / Rejection log for "+s.name+" access request.",this.view_logs=!0},formatDate(s){const e=new Date(s);return e.toDateString()+" "+e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hourCycle:"h24"})}},mounted(){this.getData()},data(){return{permissions:[],permission:null,open:!1,view_logs:!1,logs:[],userId:null,errorMessage:null,view_title:"",request_deny_states:["AP","SY","PN"],isLoading:!0}},setup(){const s=q(""),e=q("Request access to permission"),u={label:"Close"},y={label:"Submit",actionType:"progressive"},d=[{id:"name",label:"Permission"},{id:"description",label:"Description"},{id:"status",label:"Status"},{id:"actions",label:"",minWidth:"300px"}],p=[{id:"approved",label:"Status"},{id:"created",label:"Created",minWidth:"200px"},{id:"username",label:"Manager",minWidth:"100px"},{id:"comment",label:"Comment",minWidth:"320px"}];function _(b){this.permission=b,this.request_title="Request access to "+b.name,this.open=!0}return{columns:d,log_columns:p,defaultAction:u,primaryAction:y,requestPerm:_,request_title:e,requestReason:s,cdxIconJournal:B}}}),W={key:0,class:"loader d-flex justify-content-center align-middle"},J={key:3},U={class:"cdx-table__table__cell--align-number"},E={class:"permission_dialog"};function Y(s,e,u,y,d,p){const _=r("cdx-progress-indicator"),b=r("cdx-message"),c=r("cdx-info-chip"),C=r("cdx-button"),h=r("cdx-table"),x=r("cdx-text-area"),w=r("cdx-field"),k=r("cdx-dialog");return n(),v(R,null,[s.isLoading?(n(),v("div",W,[m(_,{"show-label":""},{default:o(()=>e[5]||(e[5]=[i("Loading permissions")])),_:1})])):f("",!0),s.errorMessage?(n(),a(b,{key:1,type:"error","fade-in":!0},{default:o(()=>[g("p",null,[e[6]||(e[6]=g("strong",null,"Error!",-1)),i(" "+l(s.errorMessage),1)])]),_:1})):f("",!0),e[15]||(e[15]=g("br",null,null,-1)),s.isLoading?f("",!0):(n(),a(h,{key:2,class:"cdx-docs-table-custom-cells",caption:"Permissions",columns:s.columns,data:s.permissions},{"item-source_display":o(({item:t})=>[i(l(t),1)]),"item-name":o(({item:t})=>[i(l(t),1)]),"item-status":o(({row:t})=>[t.state=="AP"?(n(),a(c,{key:0,status:"success"},{default:o(()=>[i(l(t.status_display),1)]),_:2},1024)):t.state=="SY"?(n(),a(c,{key:1,status:"success"},{default:o(()=>e[7]||(e[7]=[i(" Approved ")])),_:1})):t.state=="RJ"?(n(),a(c,{key:2,status:"error"},{default:o(()=>[i(l(t.status_display),1)]),_:2},1024)):(n(),v("span",J,l(t.status_display),1))]),"item-actions":o(({row:t})=>[g("div",U,[!t.existing&&s.request_deny_states.indexOf(t.state)==-1?(n(),a(C,{key:0,action:"progressive",weight:"primary",onClick:A=>s.requestPerm(t)},{default:o(()=>e[8]||(e[8]=[i(" Request ")])),_:2},1032,["onClick"])):f("",!0),e[10]||(e[10]=i(" Â  ")),t.request?(n(),a(C,{key:1,weight:"quiet","aria-label":"Log",onClick:A=>s.viewLog(t)},{default:o(()=>e[9]||(e[9]=[i(" View log ")])),_:2},1032,["onClick"])):f("",!0)])]),_:1},8,["columns","data"])),m(k,{open:s.open,"onUpdate:open":e[1]||(e[1]=t=>s.open=t),class:"cdx-demo-dialog-form-inputs",title:s.request_title,"use-close-button":!0,"default-action":s.defaultAction,"primary-action":s.primaryAction,onDefault:e[2]||(e[2]=t=>s.open=!1),onPrimary:s.onPrimaryAction},{default:o(()=>[g("p",E,l(s.permission.description),1),m(w,null,{label:o(()=>e[11]||(e[11]=[i(" Reason for request ")])),default:o(()=>[m(x,{modelValue:s.requestReason,"onUpdate:modelValue":e[0]||(e[0]=t=>s.requestReason=t),class:"cdx-demo-dialog-form-inputs__text-input"},null,8,["modelValue"])]),_:1})]),_:1},8,["open","title","default-action","primary-action","onPrimary"]),m(k,{open:s.view_logs,"onUpdate:open":e[3]||(e[3]=t=>s.view_logs=t),title:s.view_title,"use-close-button":!0,primaryActionDisabled:!0,"default-action":s.defaultAction,onDefault:e[4]||(e[4]=t=>s.view_logs=!1),class:"dialog_logs"},{default:o(()=>[m(h,{columns:s.log_columns,data:s.logs,caption:"",hideCaption:!0,"use-row-headers":!1},{"empty-state":o(()=>e[12]||(e[12]=[i(" There is no data available.")])),"item-approved":o(({item:t})=>[t?(n(),a(c,{key:0,status:"success"},{default:o(()=>e[13]||(e[13]=[i(" Approved ")])),_:1})):(n(),a(c,{key:1,status:"error"},{default:o(()=>e[14]||(e[14]=[i(" Rejected ")])),_:1}))]),"item-created":o(({item:t})=>[i(l(s.formatDate(t)),1)]),_:1},8,["columns","data"])]),_:1},8,["open","title","default-action"])],64)}const X=P(O,[["render",Y]]);F(X).mount("#app");
