import{_ as U,d as j,r as h,c as _,o as S,a as i,w as n,b as o,e as D,f as T,t as f,g as w,F,C as O,T as M,h as N,D as B,i as H,j as R,k as L,l as m,M as X,m as J,L as Y,x as z,n as G}from"./_plugin-vue_export-helper-CckzA7WH.js";const Q=j({name:"SSHKeyManagement",components:{CdxTable:L,CdxButton:R,CdxIcon:H,CdxDialog:B,CdxField:N,CdxTextArea:M,CdxSelect:O},data(){return{listItems:[],userId:null,systemsItems:[],delete_target:null,edit_target:null,view_target:null}},mounted(){this.getData()},methods:{async getData(){const t=await(await fetch("/accounts/api/user")).json();this.listItems=t.ssh_keys,this.userId=t.id,this.systemsItems=Object.entries(t.backends).map(([u,d])=>({label:d,value:u})),this.selected=this.systemsItems[0].value},onDefaultAction(){this.keyStatus="default",this.inputValue="",this.open=!1,this.edit=!1},onDeleteAction(){const t={method:"DELETE",headers:{"Content-Type":"application/json","X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value}},u=this.delete_target.uuid;fetch("/accounts/api/ssh/"+this.delete_target.uuid,t),this.listItems.forEach(function(d,y,c){d.uuid==u&&c.splice(y,1)}),this.confirm=!1,this.delete_target=null},onKeyInput(){this.keyStatus="default"},async onPrimaryAction(){const e=document.querySelector("[name=csrfmiddlewaretoken]").value;let t="/accounts/api/ssh",u="POST",d={user:this.userId,data:this.inputValue,system:this.selected};this.edit_target&&(d.system=this.selected,d.data=this.edit_target.data,t=t+"/"+this.edit_target.uuid,u="PUT");const y={method:u,headers:{"Content-Type":"application/json","X-CSRFToken":e},body:JSON.stringify(d)},c=await fetch(t,y),l=await c.json();c.ok?(this.getData(),this.edit_target=null,this.inputValue="",this.keyStatus="default",this.open=!1,this.edit=!1):(console.log(l),"data"in l&&(this.keyMessages.error=l.data[0],this.keyStatus="error"))},onSuspendAction(){const e=document.querySelector("[name=csrfmiddlewaretoken]").value;let t={user:this.userId,active:!this.edit_target.active,system:this.selected};const u={method:"PUT",headers:{"Content-Type":"application/json","X-CSRFToken":e},body:JSON.stringify(t)},d=this.edit_target.uuid,y=this.selected;let c="";const l=!this.edit_target.active;this.systemsItems.forEach(function(a,g,v){a.value===y&&(c=a.label)}),fetch("/accounts/api/ssh/"+this.edit_target.uuid,u),this.listItems.forEach(function(a,g,v){a.uuid==d&&(a.active=l,l?(a.system=y,a.system_display=c):(a.system="",a.system_display=""))}),this.edit_target=null,this.inputValue="",this.keyStatus="default",this.open=!1,this.edit=!1}},setup(){const e=m(!1),t=m(!1),u=m(!1),d=m(null),y=m(null),c=m(""),l=m({error:"Invalid key"}),a=m("default"),g=m("SSH Key"),v=m("Suspend selected key"),k={label:"Close"},A={label:"Save",actionType:"progressive"},p={label:"Suspend",actionType:"progressive"},s={label:"Delete",actionType:"destructive"},b=[{id:"system_display",label:"System"},{id:"data",label:"Key"},{id:"actions",label:"Actions"}];function K(r){this.edit_target=r,r.active?(this.edit_title="Suspend selected key",p.label="Suspend",p.actionType="destructive"):(this.edit_title="Active selected key",p.label="Activate",p.actionType="progressive"),this.edit=!0}function P(r){this.delete_target=r,this.confirm=!0}function V(r){this.view_target=r,this.view_title="Key ("+r.type+")",r.system&&(this.view_title=r.system_display),this.view=!0}function E(r){let C=r.split(" ");const $=C[1].length;let q=C.splice(2).join(" "),I=C[1].slice(0,68);return I.length<$&&(I=I+"..."),C[0]+" "+I+" "+q}return{open:e,edit:t,view:d,confirm:u,selected:y,inputValue:c,keyMessages:l,keyStatus:a,view_title:g,edit_title:v,primaryAction:A,deleteAction:s,suspendAction:p,defaultAction:k,columns:b,cdxIconTrash:z,cdxIconEye:Y,cdxIconPause:J,cdxIconPlay:X,editKey:K,removeKey:P,viewKey:V,truncateKey:E}}}),W={class:"cdx-docs-table-with-selection__header-content"},Z={class:"cdx-docs-table-with-selection__header-content__buttons"},x={style:{"word-break":"break-all"}},ee={class:"cdx-docs-table-custom-cells__actions"},te={key:0},se={key:1};function ne(e,t,u,d,y,c){const l=h("cdx-button"),a=h("cdx-icon"),g=h("cdx-table"),v=h("cdx-text-area"),k=h("cdx-field"),A=h("cdx-select"),p=h("cdx-dialog");return S(),_(F,null,[i(g,{class:"cdx-docs-table-custom-cells",caption:"Your SSH keys",columns:e.columns,data:e.listItems},{header:n(()=>[o("div",W,[o("span",Z,[i(l,{onClick:t[0]||(t[0]=s=>e.open=!0)},{default:n(()=>t[10]||(t[10]=[w(" Add new key ")])),_:1})])])]),"item-system_display":n(({item:s})=>[w(f(s),1)]),"item-data":n(({item:s})=>[o("span",x,f(e.truncateKey(s)),1)]),"item-comment":n(({item:s})=>[o("span",null,f(s),1)]),"item-actions":n(({row:s})=>[o("div",ee,[i(l,{weight:"quiet","aria-label":"View full",onClick:b=>e.viewKey(s)},{default:n(()=>[i(a,{icon:e.cdxIconEye},null,8,["icon"])]),_:2},1032,["onClick"]),s.active?(S(),D(l,{key:0,weight:"quiet","aria-label":"Edit",onClick:b=>e.editKey(s)},{default:n(()=>[i(a,{icon:e.cdxIconPause},null,8,["icon"])]),_:2},1032,["onClick"])):T("",!0),s.active?T("",!0):(S(),D(l,{key:1,weight:"quiet","aria-label":"Edit",onClick:b=>e.editKey(s)},{default:n(()=>[i(a,{icon:e.cdxIconPlay},null,8,["icon"])]),_:2},1032,["onClick"])),i(l,{weight:"quiet",action:"destructive","aria-label":"Remove",onClick:b=>e.removeKey(s)},{default:n(()=>[i(a,{icon:e.cdxIconTrash},null,8,["icon"])]),_:2},1032,["onClick"])])]),_:1},8,["columns","data"]),i(p,{open:e.open,"onUpdate:open":t[3]||(t[3]=s=>e.open=s),class:"cdx-dialog-form-inputs",title:"Upload new SSH key","use-close-button":!0,"default-action":e.defaultAction,"primary-action":e.primaryAction,onPrimary:e.onPrimaryAction,onDefault:e.onDefaultAction},{default:n(()=>[i(k,{status:e.keyStatus,messages:e.keyMessages},{labele:n(()=>t[11]||(t[11]=[w("Key")])),default:n(()=>[i(v,{modelValue:e.inputValue,"onUpdate:modelValue":t[1]||(t[1]=s=>e.inputValue=s),rows:"18",class:"cdx-demo-dialog-form-inputs__text-input",onInput:e.onKeyInput},null,8,["modelValue","onInput"])]),_:1},8,["status","messages"]),i(k,null,{label:n(()=>t[12]||(t[12]=[w("System")])),default:n(()=>[i(A,{selected:e.selected,"onUpdate:selected":t[2]||(t[2]=s=>e.selected=s),class:"cdx-demo-dialog-form-inputs__select","menu-items":e.systemsItems},null,8,["selected","menu-items"])]),_:1})]),_:1},8,["open","default-action","primary-action","onPrimary","onDefault"]),i(p,{open:e.edit,"onUpdate:open":t[5]||(t[5]=s=>e.edit=s),class:"cdx-dialog-form-inputs",title:e.edit_title,"use-close-button":!0,"stacked-actions":!0,"default-action":e.defaultAction,"primary-action":e.suspendAction,onPrimary:e.onSuspendAction,onDefault:e.onDefaultAction},{default:n(()=>[e.edit_target.active?(S(),_("span",te,[o("div",null,[o("strong",null,f(e.edit_target.system_display),1)]),o("div",null,[o("code",null,f(e.edit_target.data),1)])])):(S(),_("span",se,[o("div",null,[o("code",null,f(e.edit_target.data),1)]),i(k,null,{label:n(()=>t[13]||(t[13]=[w("System")])),default:n(()=>[i(A,{selected:e.selected,"onUpdate:selected":t[4]||(t[4]=s=>e.selected=s),class:"cdx-demo-dialog-form-inputs__select","menu-items":e.systemsItems},null,8,["selected","menu-items"])]),_:1})]))]),_:1},8,["open","title","default-action","primary-action","onPrimary","onDefault"]),i(p,{open:e.confirm,"onUpdate:open":t[6]||(t[6]=s=>e.confirm=s),title:"Delete key?","use-close-button":!0,"stacked-actions":!0,"primary-action":e.deleteAction,"default-action":e.defaultAction,onPrimary:e.onDeleteAction,onDefault:t[7]||(t[7]=s=>e.confirm=!1),"prop-delete-target":"delete_target"},{default:n(()=>[t[14]||(t[14]=o("p",null,[o("strong",null,"This is a destructive action."),o("br"),o("strong",null,"Deleted keys cannot be recovered!")],-1)),t[15]||(t[15]=o("p",null,"Confirm that you wish to delete the following key:",-1)),o("code",null,f(e.delete_target.data),1)]),_:1},8,["open","primary-action","default-action","onPrimary"]),i(p,{open:e.view,"onUpdate:open":t[8]||(t[8]=s=>e.view=s),title:e.view_title,"use-close-button":!0,primaryActionDisabled:"true",useDefaultAction:"true","default-action":e.defaultAction,onDefault:t[9]||(t[9]=s=>e.view=!1)},{default:n(()=>[o("code",null,f(e.view_target.data),1)]),_:1},8,["open","title","default-action"])],64)}const ie=U(Q,[["render",ne]]);G(ie).mount("#app");
